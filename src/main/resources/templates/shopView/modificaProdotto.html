<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="it">
<head>
    <meta charset="UTF-8">
    <title>Pet365 - Modifica Prodotto</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f7f8fa; }
        .card { border: none; border-radius: 20px; box-shadow: 0 6px 18px rgba(0, 0, 0, 0.08); }
        .form-label { font-weight: 600; }
        .img-thumb, .preview-img {
            width: 120px; height: 120px; object-fit: cover;
            border-radius: 12px; border: 1px solid #ddd; transition: transform .2s;
        }
        .img-thumb:hover { transform: scale(1.05); }
    </style>
</head>

<body>
<div class="container my-5">
    <div class="row justify-content-center">
        <div class="col-lg-8 col-md-10">
            <div class="card p-4">
                <h2 class="text-center mb-4 text-success fw-bold">‚úèÔ∏è Modifica Prodotto</h2>

                <form th:action="@{/admin/prodotti/aggiorna}"
                      th:object="${form}" method="post"
                      enctype="multipart/form-data">

                    <input type="hidden" th:field="*{id}"/>

                    <!-- Nome -->
                    <div class="mb-3">
                        <label class="form-label">Nome prodotto</label>
                        <input type="text" th:field="*{nome}" class="form-control" required>
                    </div>

                    <!-- Categoria -->
                    <div class="mb-3">
                        <label class="form-label">Categoria</label>
                        <input type="text" th:field="*{categoria}" class="form-control" required>
                    </div>

                    <!-- Descrizione -->
                    <div class="mb-3">
                        <label class="form-label">Descrizione</label>
                        <textarea th:field="*{descrizione}" class="form-control" rows="4" required></textarea>
                    </div>

                    <!-- Prezzo & Quantit√† -->
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Prezzo (‚Ç¨)</label>
                            <input type="number" step="0.01" th:field="*{prezzo}" class="form-control" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Quantit√† disponibile</label>
                            <input type="number" min="0" th:field="*{quantitaDisponibile}" class="form-control" required>
                        </div>
                    </div>

                    <!-- Foto esistenti -->
                    <div class="mb-4">
                        <label class="form-label">Foto attuali</label>
                        <div class="d-flex flex-wrap gap-3">
                            <div th:each="foto : ${prodotto.foto}" class="text-center">
                                <img th:src="@{/imgProdotto(id=${foto.id})}" class="img-thumb" alt="Foto prodotto">
                                <br>
                                <a th:href="@{'/admin/prodotti/' + ${prodotto.id} + '/foto/rimuovi/' + ${foto.id}}"
                                   class="btn btn-sm btn-outline-danger mt-2"
                                   onclick="return confirm('Vuoi davvero eliminare questa foto?')">üóëÔ∏è Elimina</a>
                            </div>
                        </div>
                        <div th:if="${#lists.isEmpty(prodotto.foto)}" class="text-muted mt-2">
                            Nessuna foto presente per questo prodotto.
                        </div>
                    </div>

                    <!-- Nuove foto -->
                    <div class="mb-3">
                        <label class="form-label">Aggiungi nuove foto</label>
                        <input type="file" th:field="*{foto}" class="form-control" accept="image/*" multiple id="foto-input">
                        <div class="form-text">Seleziona nuove immagini: sostituiranno le vecchie al salvataggio.</div>
                        <div id="preview-container" class="d-flex flex-wrap gap-3 mt-3"></div>
                        <div th:if="${erroreFile}" class="text-danger mt-2">Errore durante il caricamento delle immagini.</div>
                    </div>

                    <!-- Pulsante -->
                    <div class="d-grid mt-4">
                        <button type="submit" class="btn btn-success btn-lg rounded-pill">
                            üíæ Aggiorna Prodotto
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    document.getElementById('foto-input').addEventListener('change', function (event) {
        const container = document.getElementById('preview-container');
        container.innerHTML = '';
        const files = event.target.files;
        Array.from(files).forEach(file => {
            const reader = new FileReader();
            reader.onload = e => {
                const img = document.createElement('img');
                img.src = e.target.result;
                img.classList.add('preview-img');
                container.appendChild(img);
            };
            reader.readAsDataURL(file);
        });
    });
</script>
</body>
</html>
