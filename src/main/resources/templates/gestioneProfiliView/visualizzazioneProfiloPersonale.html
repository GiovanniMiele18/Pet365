<!DOCTYPE html>
<html lang="it" xmlns:th="http://www.thymeleaf.org">
<head>
    <th:block th:insert="~{fragments/head}"></th:block>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Bootstrap & FontAwesome -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <title>I miei Animali - Pet365</title>

    <style>
        body {
            background: linear-gradient(135deg, #0a6847, #064d36, #0a6847);
            color: #fff;
            font-family: 'Montserrat', sans-serif;
            min-height: 100vh;
        }

        /* Card premium */
        .premium-card {
            border: 2px solid #c9a84e;
            border-radius: 12px;
            box-shadow: 0px 4px 12px rgba(0,0,0,0.3);
            background: #fffaf0;
            color: #0a6847;
            margin-bottom: 20px;
        }
        .premium-header {
            background: linear-gradient(90deg, #0a6847, #c9a84e);
            color: white;
            padding: 15px;
            border-radius: 12px 12px 0 0;
            font-weight: bold;
        }

        /* Immagini animali */
        .animal-img {
            border-radius: 12px;
            border: 3px solid #c9a84e;
            max-height: 200px;
            object-fit: cover;
            width: 100%;
        }

        /* Bottoni */
        .btn-premium {
            background-color: #0a6847;
            color: white;
            border: none;
            transition: all 0.3s ease;
        }
        .btn-premium:hover {
            background-color: #c9a84e;
            color: #fff;
        }

        /* Box punti osso */
        .osso-box {
            border: 2px dashed #c9a84e;
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            font-weight: bold;
            color: #c9a84e;
            background: #0a6847;
        }

        /* Carosello */
        #animaliCarousel {
            position: relative;
            min-height: 750px;
        }
        .carousel-item {
            transition: none !important;
        }

        /* Frecce STICKY: restano centrate nello schermo */
        .carousel-control-prev,
        .carousel-control-next {
            position: fixed;             /* fissate alla finestra */
            top: 50%;                    /* sempre metÃ  schermo */
            transform: translateY(-50%);
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #0a6847, #c9a84e);
            opacity: 0.9;
            z-index: 1050;               /* sopra tutto */
        }
        .carousel-control-prev {
            left: 20px;
        }
        .carousel-control-next {
            right: 20px;
        }
        .carousel-control-prev:hover,
        .carousel-control-next:hover {
            opacity: 1;
        }
        .carousel-control-prev-icon,
        .carousel-control-next-icon {
            filter: invert(1) sepia(100%) hue-rotate(20deg) saturate(300%);
            width: 30px;
            height: 30px;
        }

        /* Nome cliente */
        .client-name {
            text-align: center;
            font-size: 1.8rem;
            font-weight: bold;
            color: #c9a84e;
            margin-bottom: 20px;
            text-shadow: 1px 1px 2px #0a6847;
        }

        /* ResponsivitÃ  */
        @media (max-width: 768px) {
            .premium-card {
                margin: 10px 0;
            }
            .animal-img {
                max-height: 150px;
            }
            .carousel-control-prev,
            .carousel-control-next {
                width: 45px;
                height: 45px;
            }
            .carousel-control-prev-icon,
            .carousel-control-next-icon {
                width: 20px;
                height: 20px;
            }
        }
    </style>
</head>
<body>

<!-- Navbar -->
<th:block th:insert="~{fragments/navbar}"></th:block>

<div class="container mt-4">

    <!-- Nome Cliente -->
    <div class="client-name">
        ðŸ‘¤ <span th:text="${cliente.nome} + ' ' + ${cliente.cognome}">Mario Rossi</span>
    </div>

    <!-- Osso Point -->
    <div class="osso-box mb-4">
        ðŸ¦´ <span>120</span> Osso Point
    </div>

    <!-- Se non ci sono animali -->
    <div th:if="${#lists.isEmpty(cliente.animali)}" class="text-center mb-4">
        <a href="/aggiungiAnimale" class="btn btn-premium btn-lg">âž• Aggiungi Animale</a>
    </div>

    <!-- Se ci sono animali -->
    <div th:if="${!#lists.isEmpty(cliente.animali)}">
        <div id="animaliCarousel" class="carousel slide" data-bs-interval="false">
            <div class="carousel-inner">
                <div th:each="animale, iterStat : ${cliente.animali}"
                     th:classappend="${iterStat.index == 0} ? ' active' : ''"
                     class="carousel-item">
                    <div class="premium-card">

                        <!-- Header -->
                        <div class="premium-header d-flex justify-content-between align-items-center">
                            <h4 th:text="${animale.nome}">Nome Animale</h4>
                            <a th:href="@{/aggiungiAnimale}" class="btn btn-premium">âž• Aggiungi Animale</a>
                        </div>

                        <!-- Dettagli Animale -->
                        <div class="row p-4">
                            <div class="col-md-4 text-center">
                                <img th:if="${!#lists.isEmpty(animale.fotoAnimali)}"
                                     th:src="@{'/immagineanimale?id=' + ${animale.fotoAnimali[0].id}}"
                                     class="animal-img" alt="Foto animale">
                                <img th:if="${#lists.isEmpty(animale.fotoAnimali)}"
                                     src="/images/default-pet.png"
                                     class="animal-img" alt="Foto non disponibile">
                            </div>
                            <div class="col-md-8">
                                <p><b>Specie:</b> <span th:text="${animale.specie}">Cane</span></p>
                                <p><b>Razza:</b> <span th:text="${animale.razza}">Labrador</span></p>
                                <p><b>EtÃ :</b> <span th:text="${animale.eta}">3</span> anni</p>
                                <p><b>Sesso:</b> <span th:text="${animale.sesso}">Maschio</span></p>
                                <p><b>Peso:</b> <span th:text="${animale.peso}">20</span> kg</p>
                                <p><b>Colore:</b> <span th:text="${animale.colore}">Nero</span></p>
                                <p><b>Note:</b> <span th:text="${animale.note}">Molto vivace</span></p>
                            </div>
                        </div>

                        <!-- Documenti e Prenotazioni -->
                        <div class="row mt-3 align-items-stretch">
                            <!-- Documenti -->
                            <div class="col-md-6 d-flex">
                                <div class="premium-card d-flex flex-column h-100 w-100">
                                    <div class="premium-header">ðŸ“‚ Documenti</div>
                                    <div class="p-3 flex-grow-1">
                                        <ul class="list-group">
                                            <li class="list-group-item d-flex justify-content-between align-items-center"
                                                th:each="doc : ${animale.documenti}">
                                                <div>
                                                    ðŸ“„
                                                    <span th:text="${doc.nome}">Nome Documento</span>
                                                    <span th:if="${doc.estensione != null}" th:text="${doc.estensione}">.pdf</span>
                                                </div>
                                                <div>
                                                    <a th:href="@{'/documenti/download/' + ${doc.id}}"
                                                       class="btn btn-sm btn-outline-success me-2">
                                                        <i class="fa-solid fa-download"></i>
                                                    </a>
                                                    <form th:action="@{'/documenti/elimina/' + ${doc.id}}" method="post" style="display:inline;">
                                                        <button type="submit" class="btn btn-sm btn-outline-danger"
                                                                onclick="return confirm('Sei sicuro di voler eliminare questo documento?');">
                                                            <i class="fa-solid fa-trash"></i>
                                                        </button>
                                                    </form>
                                                </div>
                                            </li>
                                            <li th:if="${#lists.isEmpty(animale.documenti)}" class="list-group-item">
                                                Nessun documento disponibile
                                            </li>
                                        </ul>
                                    </div>
                                    <div class="p-3 mt-auto">
                                        <a th:href="@{'/documenti/aggiungi/' + ${animale.id}}" class="btn btn-premium w-100">
                                            âž• Aggiungi Documento
                                        </a>
                                    </div>
                                </div>
                            </div>

                            <!-- Prenotazioni -->
                            <div class="col-md-6 d-flex">
                                <div class="premium-card d-flex flex-column h-100 w-100">
                                    <div class="premium-header">ðŸ“… Prenotazioni</div>
                                    <div class="p-3 flex-grow-1">
                                        <ul class="list-group">
                                            <li class="list-group-item" th:each="pren : ${animale.prenotazioni}">
                                                ðŸ“Œ
                                                <p><b>AttivitÃ :</b> <span th:text="${pren.visita.annuncio.nomeAttivita}">Veterinaria</span></p>
                                                <p><b>Servizio:</b> <span th:text="${pren.visita.annuncio.serviziOfferti}">Petsitting</span></p>
                                                <p><b>Data:</b>
                                                    <span th:text="${#temporals.format(pren.dataVisita, 'dd/MM/yyyy')}">15/10/2025</span>
                                                </p>
                                                <p><b>Orario:</b>
                                                    <span th:text="${#temporals.format(pren.visita.orarioInizio, 'HH:mm')} + ' - ' + ${#temporals.format(pren.visita.orarioFine, 'HH:mm')}">10:00 - 11:00</span>
                                                </p>
                                                <div>
                                                    <form th:action="@{'/prenotazioni/elimina/' + ${pren.id}}" method="post" style="display:inline;">
                                                        <button type="submit" class="btn btn-sm btn-outline-danger"
                                                                onclick="return confirm('Sei sicuro di voler eliminare questa prenotazione?');">
                                                            <i class="fa-solid fa-trash"></i>
                                                        </button>
                                                    </form>
                                                </div>
                                            </li>
                                            <li th:if="${#lists.isEmpty(animale.prenotazioni)}" class="list-group-item">
                                                Nessuna prenotazione disponibile
                                            </li>
                                        </ul>
                                    </div>
                                    <div class="p-3 mt-auto">
                                        <a th:href="@{'/ricercaAnnunci'}" class="btn btn-premium w-100">
                                            âž• Aggiungi Prenotazione
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div> <!-- fine row -->

                    </div>
                </div>
            </div>

            <!-- Frecce carosello -->
            <button class="carousel-control-prev" type="button" data-bs-target="#animaliCarousel" data-bs-slide="prev">
                <span class="carousel-control-prev-icon"></span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#animaliCarousel" data-bs-slide="next">
                <span class="carousel-control-next-icon"></span>
            </button>
        </div>
    </div>
</div>

<!-- Footer -->
<th:block th:insert="~{fragments/footbar}"></th:block>
<th:block th:insert="~{fragments/scripts}"></th:block>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
